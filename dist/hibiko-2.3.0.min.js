/*!
 * Hibiko v2.3.0
 * https://mifitto.com
 *
 * Copyright (c) 2014 
 * Released under the MIT license
 *
 * Date: 2014-04-07
 */
!function(){var a,b=this,c={},d=function(a,b){var c=!1;if("string"==typeof a)return a.indexOf(b)>-1;for(var d=a.length-1;d>=0;d--)if(a[d].indexOf(b)>-1){c=!0;break}return c};a=function(a,b){this.target=a,this.targetOriginWhitelist="[object Array]"===Object.prototype.toString.call(b)?b:[b],this.wpmAvailable="undefined"!=typeof window.postMessage,this.rpcs={},this.JSONMessageIdentifier=";;JSON;;",this.RPCMessageIdentifier=";;RPC;;",window.addEventListener("message",this.__onMessage.bind(this),!1)},a.prototype.postMessage=function(a){if(this.wpmAvailable){"object"==typeof a&&a.rpName?a=this.RPCMessageIdentifier+JSON.stringify(a):"object"==typeof a&&(a=this.JSONMessageIdentifier+JSON.stringify(a));for(var b=this.targetOriginWhitelist.length-1;b>=0;b--)this.target.postMessage(a,this.targetOriginWhitelist[b])}},a.prototype.__onMessage=function(a){if(this.wpmAvailable&&d(this.targetOriginWhitelist,a.origin)){var b=a.data;if(0===b.indexOf(this.JSONMessageIdentifier))return b=JSON.parse(b.replace(this.JSONMessageIdentifier,"")),this.messageCallback(b);if(0===b.indexOf(this.RPCMessageIdentifier)){if(b=JSON.parse(b.replace(this.RPCMessageIdentifier,"")),!this.rpcs[b.rpName])return;return this.rpcs[b.rpName].apply(null,b.rpParams)}return this.messageCallback(b)}},a.prototype.onMessage=function(a){this.wpmAvailable&&(this.messageCallback=a)},a.prototype.registerRp=function(a,b){this.wpmAvailable&&(this.rpcs[a]=b)},a.prototype.callRp=function(a,b){return this.wpmAvailable&&"undefined"!=typeof a&&"undefined"!=typeof b?void this.postMessage({rpName:a,rpParams:b}):!1},c.init=function(b,c){return window.postMessage?new a(b,c):!1},c.inIframe=function(){try{return window.self!==window.top}catch(a){return!0}},"undefined"!=typeof define&&define.amd?define([],function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:b.Hibiko=c}();